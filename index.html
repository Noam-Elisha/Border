<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #2d2d2d;
            position: relative;
        }

        .image-container {
            max-width: 80%;
            max-height: 80%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #555;
            border-radius: 8px;
            padding: 20px;
            background: #333;
        }

        .image-container.has-image {
            border: none;
            background: transparent;
            padding: 0;
            position: relative;
            overflow: hidden;
            border-radius: 0;
        }

        .display-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 2;
        }

        .blur-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: blur(20px);
            z-index: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .blur-background.active {
            opacity: 1;
        }

        .upload-area {
            text-align: center;
            cursor: pointer;
            padding: 40px;
            transition: all 0.2s ease;
            transform: scale(1);
            position: relative;
            z-index: 3;
        }

        .upload-area:hover {
            background: #444;
        }

        .upload-area:active {
            transform: scale(0.98);
            background: #555;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .upload-text {
            font-size: 18px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .upload-subtext {
            font-size: 14px;
            opacity: 0.6;
        }

        .sidebar {
            width: 300px;
            background: #252526;
            border-left: 1px solid #3c3c3c;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar h2 {
            margin-bottom: 20px;
            color: #cccccc;
            font-size: 18px;
            border-bottom: 1px solid #3c3c3c;
            padding-bottom: 10px;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #cccccc;
            font-size: 14px;
        }

        .control-group input[type="file"] {
            width: 100%;
            padding: 8px;
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 4px;
            color: #fff;
            margin-bottom: 10px;
        }

        .control-group input[type="color"] {
            width: 100%;
            height: 40px;
            padding: 0;
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .control-group select {
            width: 100%;
            padding: 8px;
            background: #3c3c3c;
            border: 1px solid #555;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: #3c3c3c;
            border-radius: 0;
            outline: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #007acc;
            border-radius: 0;
            cursor: pointer;
        }

        .control-group input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #007acc;
            border-radius: 0;
            cursor: pointer;
            border: none;
        }

        .range-value {
            display: inline-block;
            min-width: 40px;
            text-align: center;
            background: #3c3c3c;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            color: #fff;
        }

        .control-group button {
            width: 100%;
            padding: 10px;
            background: #007acc;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 8px;
            transition: background-color 0.3s;
        }

        .control-group button:hover {
            background: #005a9e;
        }

        .control-group button.secondary {
            background: #555;
        }

        .control-group button.secondary:hover {
            background: #666;
        }

        .hidden-input {
            display: none;
        }

        .image-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
        }

        .dimensions-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <div class="image-container" id="imageContainer">
                <div class="blur-background" id="blurBackground"></div>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ðŸ“·</div>
                    <div class="upload-text">Click to upload an image</div>
                    <div class="upload-subtext">or drag and drop</div>
                </div>
                <img id="displayImage" class="display-image" style="display: none;" />
            </div>
            <div class="image-info" id="imageInfo" style="display: none;"></div>
            <div class="dimensions-info" id="dimensionsInfo" style="display: none;"></div>
        </div>

        <div class="sidebar">
            <h2>Controls</h2>
            
            <div class="control-group">
                <input type="file" id="fileInput" accept="image/*" class="hidden-input">
                <button onclick="document.getElementById('fileInput').click()">Choose File</button>
                <button class="secondary" onclick="clearImage()">Clear Image</button>
                <button onclick="exportImage()">Export Image</button>
            </div>

            <h2>Border Controls</h2>
            
            <div class="control-group">
                <label>Border Width: <span class="range-value" id="borderWidthValue">0</span>%</label>
                <input type="range" id="borderWidth" min="0" max="100" value="0" oninput="applyBorderFast()">
            </div>
            
            <div class="control-group">
                <label>Background Type:</label>
                <select id="backgroundType" onchange="toggleBackgroundType()">
                    <option value="color">Solid Color</option>
                    <option value="blur">Blur Background</option>
                </select>
            </div>
            
            <div class="control-group" id="colorGroup">
                <label>Border Color:</label>
                <input type="color" id="borderColor" value="#ffffff" onchange="applyBorderFast()">
            </div>
            
            <div class="control-group">
                <label>Aspect Ratio:</label>
                <select id="aspectRatio" onchange="toggleCustomAspectRatio()">
                    <option value="original">Original</option>
                    <option value="1:1">1:1 (Square)</option>
                    <option value="3:2">3:2</option>
                    <option value="4:3">4:3</option>
                    <option value="1.91:1">1.91:1 (Instagram)</option>
                    <option value="4:5">4:5 (Instagram)</option>
                    <option value="16:9">16:9</option>
                    <option value="custom">Custom</option>
                </select>
            </div>
            
            <div class="control-group" id="customAspectGroup" style="display: none;">
                <label>Custom Ratio:</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="number" id="customRatioX" min="0.1" step="0.1" value="1" style="width: 60px; padding: 4px; background: #3c3c3c; border: 1px solid #555; border-radius: 4px; color: #fff;">
                    <span>:</span>
                    <input type="number" id="customRatioY" min="0.1" step="0.1" value="1" style="width: 60px; padding: 4px; background: #3c3c3c; border: 1px solid #555; border-radius: 4px; color: #fff;">
                    <button type="button" onclick="applyAspectRatio()" style="padding: 4px 8px; margin: 0; width: auto; font-size: 12px;">Apply</button>
                </div>
            </div>
            
        </div>


    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const displayImage = document.getElementById('displayImage');
        const imageContainer = document.getElementById('imageContainer');
        const uploadArea = document.getElementById('uploadArea');
        const imageInfo = document.getElementById('imageInfo');

        // File input change event
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                loadImage(file);
            }
        });

        // Drag and drop functionality
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.style.background = '#444';
        });

        uploadArea.addEventListener('dragleave', function(e) {
            uploadArea.style.background = '';
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.style.background = '';
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                loadImage(file);
            }
        });

        // Click to upload
        uploadArea.addEventListener('click', function() {
            fileInput.click();
        });

        function loadImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                displayImage.src = e.target.result;
                displayImage.style.display = 'block';
                uploadArea.style.display = 'none';
                imageContainer.classList.add('has-image');
                
                // Show image info
                displayImage.onload = function() {
                    // Cache values for performance
                    originalPixels = this.naturalWidth * this.naturalHeight;
                    originalFileSize = file.size;
                    dimensionsInfo = document.getElementById('dimensionsInfo');
                    
                    // Set up blur background when image loads
                    const blurBackground = document.getElementById('blurBackground');
                    blurBackground.style.backgroundImage = `url(${displayImage.src})`;
                    blurBackgroundReady = true;
                    
                    const kb = (file.size / 1024).toFixed(1);
                    imageInfo.innerHTML = `
                        <strong>${file.name}</strong><br>
                        ${this.naturalWidth} Ã— ${this.naturalHeight}px<br>
                        ${kb} KB
                    `;
                    imageInfo.style.display = 'block';
                    dimensionsInfo.style.display = 'block';
                    updateDimensions();
                };
            };
            reader.readAsDataURL(file);
        }

        function clearImage() {
            // Clear image display
            displayImage.style.display = 'none';
            displayImage.src = '';
            displayImage.removeAttribute('src');
            
            // Reset UI
            uploadArea.style.display = 'block';
            imageContainer.classList.remove('has-image');
            imageInfo.style.display = 'none';
            document.getElementById('dimensionsInfo').style.display = 'none';
            
            // Reset file input
            fileInput.value = '';
            
            // Reset border controls
            document.getElementById('borderWidth').value = 0;
            document.getElementById('borderWidthValue').textContent = '0';
            document.getElementById('borderColor').value = '#ffffff';
            document.getElementById('backgroundType').value = 'color';
            
            // Clear blur background
            const blurBackground = document.getElementById('blurBackground');
            blurBackground.classList.remove('active');
            blurBackground.style.backgroundImage = '';
            blurBackground.style.transform = '';
            
            toggleBackgroundType();
            
            // Clear cached values
            originalPixels = null;
            originalFileSize = null;
            dimensionsInfo = null;
            blurBackgroundReady = false;
        }

        // Cache DOM elements and calculations for better performance
        let dimensionsInfo, originalPixels, originalFileSize, blurBackgroundReady = false;

        function toggleBackgroundType() {
            const backgroundType = document.getElementById('backgroundType').value;
            const colorGroup = document.getElementById('colorGroup');
            const blurBackground = document.getElementById('blurBackground');
            
            if (backgroundType === 'color') {
                colorGroup.style.display = 'block';
                blurBackground.classList.remove('active');
            } else {
                colorGroup.style.display = 'none';
            }
            
            // Apply border with new background type
            if (displayImage.src) {
                applyBorderFast();
            }
        }

        function applyBorderFast() {
            const borderPercent = document.getElementById('borderWidth').value;
            
            // Update display value
            document.getElementById('borderWidthValue').textContent = borderPercent;
            
            if (displayImage.src) {
                // Calculate border width so that 100% = image width doubles
                // At 100%, border should be 50% of original width on each side
                const borderWidthPx = (borderPercent / 100) * displayImage.naturalWidth * .05;
                const backgroundType = document.getElementById('backgroundType').value;
                
                // Get stored aspect ratio border values or default to 0
                const aspectLeft = displayImage.aspectBorderLeft || 0;
                const aspectRight = displayImage.aspectBorderRight || 0;
                const aspectTop = displayImage.aspectBorderTop || 0;
                const aspectBottom = displayImage.aspectBorderBottom || 0;
                
                // Check if we have stored aspect ratio values
                const hasAspectRatio = displayImage.aspectRatioX && displayImage.aspectRatioY;
                
                let finalBorderLeft, finalBorderRight, finalBorderTop, finalBorderBottom;
                
                if (hasAspectRatio) {
                    // Use stored aspect ratio to maintain proportions when adding border
                    const ratioX = displayImage.aspectRatioX;
                    const ratioY = displayImage.aspectRatioY;
                    
                    // Determine which dimension is shorter in the aspect ratio
                    const isXShorter = ratioX <= ratioY;
                    
                    if (isXShorter) {
                        // X is shorter, add borderWidthPx to X and calculate proportional Y
                        const additionalY = borderWidthPx * (ratioY / ratioX);
                        
                        finalBorderLeft = aspectLeft + borderWidthPx / 2;
                        finalBorderRight = aspectRight + borderWidthPx / 2;
                        finalBorderTop = aspectTop + additionalY / 2;
                        finalBorderBottom = aspectBottom + additionalY / 2;
                    } else {
                        // Y is shorter, add borderWidthPx to Y and calculate proportional X
                        const additionalX = borderWidthPx * (ratioX / ratioY);
                        
                        finalBorderLeft = aspectLeft + additionalX / 2;
                        finalBorderRight = aspectRight + additionalX / 2;
                        finalBorderTop = aspectTop + borderWidthPx / 2;
                        finalBorderBottom = aspectBottom + borderWidthPx / 2;
                    }
                } else {
                    // No aspect ratio, use uniform border
                    finalBorderLeft = borderWidthPx;
                    finalBorderRight = borderWidthPx;
                    finalBorderTop = borderWidthPx;
                    finalBorderBottom = borderWidthPx;
                }
                
                if (backgroundType === 'color') {
                    const borderColor = document.getElementById('borderColor').value;
                    displayImage.style.borderLeft = `${finalBorderLeft}px solid ${borderColor}`;
                    displayImage.style.borderRight = `${finalBorderRight}px solid ${borderColor}`;
                    displayImage.style.borderTop = `${finalBorderTop}px solid ${borderColor}`;
                    displayImage.style.borderBottom = `${finalBorderBottom}px solid ${borderColor}`;
                    displayImage.style.boxShadow = 'none';
                } else {
                    // Use blur background
                    displayImage.style.borderLeft = `${finalBorderLeft}px solid transparent`;
                    displayImage.style.borderRight = `${finalBorderRight}px solid transparent`;
                    displayImage.style.borderTop = `${finalBorderTop}px solid transparent`;
                    displayImage.style.borderBottom = `${finalBorderBottom}px solid transparent`;
                    displayImage.style.boxShadow = 'none';
                    
                    // Just adjust blur background positioning (already set up in loadImage)
                    const blurBackground = document.getElementById('blurBackground');
                    blurBackground.classList.add('active');
                    
                    // Adjust blur background scale to account for total border
                    const maxBorderX = Math.max(finalBorderLeft, finalBorderRight);
                    const maxBorderY = Math.max(finalBorderTop, finalBorderBottom);
                    const scaleX = (displayImage.naturalWidth + maxBorderX * 2) / displayImage.naturalWidth;
                    const scaleY = (displayImage.naturalHeight + maxBorderY * 2) / displayImage.naturalHeight;
                    blurBackground.style.transform = `scale(${Math.max(scaleX, scaleY)})`;
                }
                
                // Update dimensions in real-time with cached values using actual final border values
                if (originalPixels && originalFileSize) {
                    const totalWidth = displayImage.naturalWidth + finalBorderLeft + finalBorderRight;
                    const totalHeight = displayImage.naturalHeight + finalBorderTop + finalBorderBottom;
                    const newPixels = totalWidth * totalHeight;
                    const pixelRatio = newPixels / originalPixels;
                    const estimatedSize = (originalFileSize * pixelRatio / 1024).toFixed(1);
                    
                    dimensionsInfo.innerHTML = `
                        <strong>With Border:</strong><br>

                        ${Math.round(totalWidth)} Ã— ${Math.round(totalHeight)}px<br>
                        ${estimatedSize} KB
                    `;
                }
            }
        }



        function updateBorderPreview() {
            applyBorderFast();
        }

        function applyBorder() {
            applyBorderFast();
        }

        function updateDimensions() {
            applyBorderFast();
        }

        function toggleCustomAspectRatio() {
            const aspectRatio = document.getElementById('aspectRatio').value;
            const customGroup = document.getElementById('customAspectGroup');
            
            if (aspectRatio === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
                // Apply the selected preset ratio immediately
                applyAspectRatio();
            }
        }

        function applyAspectRatio() {
            const aspectRatio = document.getElementById('aspectRatio').value;
            
            if (!displayImage.src) {
                return; // No image loaded
            }
            
            // TODO: Implement aspect ratio logic here
            // You can access the selected ratio with: aspectRatio
            // Current image dimensions: displayImage.naturalWidth, displayImage.naturalHeight
            

            const width = displayImage.naturalWidth;
            const height = displayImage.naturalHeight;

            // Calculate new dimensions based on aspect ratio
            let newWidth = width;
            let newHeight = height;
            let ratioX, ratioY;
            
            if (aspectRatio === 'original') {
                newWidth = width;
                newHeight = height;
            } else if (aspectRatio === 'custom') {
                // Get custom ratio values
                ratioX = parseFloat(document.getElementById('customRatioX').value);
                ratioY = parseFloat(document.getElementById('customRatioY').value);
                
                if (!ratioX || !ratioY || ratioX <= 0 || ratioY <= 0) {
                    alert('Please enter valid positive numbers for the custom aspect ratio.');
                    return;
                }
            } else {
                // Parse preset ratio
                [ratioX, ratioY] = aspectRatio.split(':').map(Number);
            }
            
            if (aspectRatio !== 'original') {
                if (!isNaN(ratioX) && !isNaN(ratioY) && ratioX > 0 && ratioY > 0) {
                    // Calculate based on width
                    let calcHeight = Math.round(width * (ratioY / ratioX));
                    // Calculate based on height
                    let calcWidth = Math.round(height * (ratioX / ratioY));

                    // Choose the one that is greater than or equal to original dimensions
                    if (calcHeight >= height && width >= width) {
                        newWidth = width;
                        newHeight = calcHeight;
                    } else if (calcWidth >= width && height >= height) {
                        newWidth = calcWidth;
                        newHeight = height;
                    } 
                }
            }

            // Store aspect ratio border values for applyBorderFast to use
            const widthDiff = newWidth - width;
            const heightDiff = newHeight - height;
            
            if (aspectRatio === 'original') {
                // Reset everything for original
                displayImage.aspectBorderLeft = 0;
                displayImage.aspectBorderRight = 0;
                displayImage.aspectBorderTop = 0;
                displayImage.aspectBorderBottom = 0;
                displayImage.aspectRatioX = null;
                displayImage.aspectRatioY = null;
            } else {
                // Store the aspect ratio borders separately
                displayImage.aspectBorderLeft = widthDiff / 2;
                displayImage.aspectBorderRight = widthDiff / 2;
                displayImage.aspectBorderTop = heightDiff / 2;
                displayImage.aspectBorderBottom = heightDiff / 2;
                // Store the actual aspect ratio values for reuse
                displayImage.aspectRatioX = ratioX;
                displayImage.aspectRatioY = ratioY;
            }
            
            // Apply borders through applyBorderFast
            applyBorderFast();

            console.log('New dimensions:', newWidth, newHeight);
            console.log('Selected aspect ratio:', aspectRatio);
        }

        function exportImage() {
            if (!displayImage.src) {
                alert('Please load an image first');
                return;
            }

            // Show loading state
            const exportBtn = document.querySelector('button[onclick="exportImage()"]');
            const originalText = exportBtn.textContent;
            const originalCursor = document.body.style.cursor;
            
            exportBtn.textContent = 'Exporting...';
            exportBtn.disabled = true;
            document.body.style.cursor = 'wait';

            // Use setTimeout to allow UI to update before heavy processing
            setTimeout(() => {
                try {
                    const borderPercent = document.getElementById('borderWidth').value;
                    const borderWidthPx = (borderPercent / 100) * displayImage.naturalWidth * 0.5;
                    
                    // Create canvas with border
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d', { alpha: false });
                    
                    // Set canvas size to include border
                    const totalWidth = displayImage.naturalWidth + (borderWidthPx * 2);
                    const totalHeight = displayImage.naturalHeight + (borderWidthPx * 2);
                    canvas.width = totalWidth;
                    canvas.height = totalHeight;
                    
                    const backgroundType = document.getElementById('backgroundType').value;
                    
                    if (backgroundType === 'color') {
                        // Fill with solid color
                        const borderColor = document.getElementById('borderColor').value;
                        ctx.fillStyle = borderColor;
                        ctx.fillRect(0, 0, totalWidth, totalHeight);
                    } else {
                        // Create blur background
                        ctx.filter = 'blur(20px)';
                        ctx.drawImage(displayImage, -borderWidthPx, -borderWidthPx, totalWidth + borderWidthPx * 2, totalHeight + borderWidthPx * 2);
                        ctx.filter = 'none';
                    }
                    
                    // Draw image centered
                    ctx.drawImage(displayImage, Math.floor(borderWidthPx), Math.floor(borderWidthPx));
                    
                    // Download the image
                    const dataURL = canvas.toDataURL('image/png');
                    const a = document.createElement('a');
                    a.href = dataURL;
                    a.download = 'image-with-border.png';
                    a.click();
                    
                } finally {
                    // Reset UI state
                    exportBtn.textContent = originalText;
                    exportBtn.disabled = false;
                    document.body.style.cursor = originalCursor;
                }
            }, 10);
        }
    </script>
</body>
</html>
